<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Painel de Temas</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; margin: 0; padding: 20px; }
    h1 { color: #246493; }
    form { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    input, textarea, select, button { display: block; width: 100%; margin-bottom: 10px; padding: 8px; }
    button { background: #246493; color: #fff; border: none; cursor: pointer; }
    button:hover { background: #3399ff; }
  </style>
</head>
<body>
  <h1>Adicionar Novo Tema</h1>
  <form id="form-tema" enctype="multipart/form-data">
    <label for="tipo">Tipo de Tema:</label>
    <select id="tipo" name="tipo">
      <option value="ENEM">ENEM</option>
      <option value="Vestibular">Vestibular</option>
      <option value="Concursos">Concursos</option>
    </select>

    <label for="titulo">Título:</label>
    <input type="text" id="titulo" name="titulo" required>

    <label for="instrucoes">Instruções:</label>
    <textarea id="instrucoes" name="instrucoes" required></textarea>

    <label for="proposta">Proposta de Redação:</label>
    <textarea id="proposta" name="proposta" required></textarea>

    <label for="capa">Imagem de Capa do Tema:</label>
    <input type="file" id="capa" name="capa" accept="image/*" required>

    <label>Textos Motivadores (texto):</label>
    <div id="textos-motivadores-container">
      <div class="texto-motivador-bloco">
        <input type="text" name="textosMotivadores" placeholder="Texto motivador">
        <input type="text" name="fontesMotivadores" placeholder="Fonte do texto (opcional)">
      </div>
    </div>
    <button type="button" onclick="adicionarCampoTexto()">Adicionar outro texto</button>

    <label for="imagensMotivadoras">Textos Motivadores (imagens):</label>
    <div id="imagens-motivadoras-container">
      <div class="imagem-motivadora-bloco">
        <input type="file" name="imagensMotivadoras" accept="image/*">
        <input type="text" name="fontesImagensMotivadoras" placeholder="Fonte da imagem (opcional)">
      </div>
    </div>
    <button type="button" onclick="adicionarCampoImagem()">Adicionar outra imagem</button>

    <button type="submit">Adicionar Tema</button>
  </form>

  <script>
    function adicionarCampoTexto() {
      const container = document.getElementById('textos-motivadores-container');
      const bloco = document.createElement('div');
      bloco.className = 'texto-motivador-bloco';
      bloco.innerHTML = `
        <input type="text" name="textosMotivadores" placeholder="Texto motivador">
        <input type="text" name="fontesMotivadores" placeholder="Fonte do texto (opcional)">
      `;
      container.appendChild(bloco);
    }

    function adicionarCampoImagem() {
      const container = document.getElementById('imagens-motivadoras-container');
      const bloco = document.createElement('div');
      bloco.className = 'imagem-motivadora-bloco';
      bloco.innerHTML = `
        <input type="file" name="imagensMotivadoras" accept="image/*">
        <input type="text" name="fontesImagensMotivadoras" placeholder="Fonte da imagem (opcional)">
      `;
      container.appendChild(bloco);
    }

    document.getElementById('form-tema').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData();

      // Adiciona campos simples
      formData.append('tipo', form.tipo.value);
      formData.append('titulo', form.titulo.value);
      formData.append('instrucoes', form.instrucoes.value);
      formData.append('proposta', form.proposta.value);

      // Adiciona imagem de capa
      if (form.capa.files.length > 0) {
        formData.append('capa', form.capa.files[0]);
      }

      // Adiciona textos motivadores (texto) e fontes
      const textos = form.querySelectorAll('input[name="textosMotivadores"]');
      const fontesTextos = form.querySelectorAll('input[name="fontesMotivadores"]');
      textos.forEach((input, idx) => {
        if (input.value.trim()) formData.append('textosMotivadores', input.value);
        // Mesmo que não tenha texto, envie fonte para manter o alinhamento dos índices
        if (fontesTextos[idx]) formData.append('fontesMotivadores', fontesTextos[idx].value);
      });

      // Adiciona textos motivadores (imagens) e fontes
      const imagensInputs = form.querySelectorAll('input[name="imagensMotivadoras"]');
      const fontesImagens = form.querySelectorAll('input[name="fontesImagensMotivadoras"]');
      imagensInputs.forEach((input, idx) => {
        if (input.files.length > 0) formData.append('imagensMotivadoras', input.files[0]);
        if (fontesImagens[idx]) formData.append('fontesImagensMotivadoras', fontesImagens[idx].value);
      });

      const response = await fetch('/temas', {
        method: 'POST',
        body: formData,
      });
      if (response.ok) {
        alert('Tema adicionado com sucesso!');
        form.reset();
        document.getElementById('textos-motivadores-container').innerHTML = `<div class="texto-motivador-bloco">
          <input type="text" name="textosMotivadores" placeholder="Texto motivador">
          <input type="text" name="fontesMotivadores" placeholder="Fonte do texto (opcional)">
        </div>`;
        document.getElementById('imagens-motivadoras-container').innerHTML = `<div class="imagem-motivadora-bloco">
          <input type="file" name="imagensMotivadoras" accept="image/*">
          <input type="text" name="fontesImagensMotivadoras" placeholder="Fonte da imagem (opcional)">
        </div>`;
      } else {
        alert('Erro ao adicionar tema.');
      }
    });
  </script>
</body>
</html>